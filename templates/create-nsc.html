<section class="meistertools content">

    <!-- Navigation -->
    <nav class="tabs">
        <a class="item active" data-tab="random-nsc">NSC Erstellen</a>
        <a class="item" data-tab="characters">Existierende NSC in Szene</a>
    </nav>


    <!--
       generate random NPC
    -->
    <section class="tab" data-tab="random-nsc">

        <!-- list alle stored patterns -->
        {{#if settings.storedPatterns}}
        <div class="round-box">
            <header>
                <h2>Gespeicherte Vorlagen</h2>
            </header>
            <main class="flow">
                {{#each settings.storedPatterns as |pattern n|}}
                <div class="button-box">
                    <button name="load-pattern" data-pattern="{{n}}" type="button">{{pattern.name}}</button>
                    <button name="delete-pattern" data-pattern="{{n}}" type="button" class="delete"><i
                            class="fas fa-trash-alt"></i></button>
                </div>
                {{/each}}
            </main>
        </div>
        {{/if}}


        <section class="round-box">
            <header>
                <h2>Rasse und Herkunft</h2>
            </header>
            <main>
                {{#each archetypes}}
                <div class="round-box inner no-header img-left"
                     style="background-image: url('{{img}}');">
                    <div class="flow" style="margin-left: 40px">
                        {{#each origins}}
                        <div class="boxed-radio">
                            <input id="origin-{{key}}" type="radio" name="origin" value="{{key}}"
                                   {{checked_radio key ../../data.origin}} />
                            <label for="origin-{{key}}">
                                {{name}}
                                {{#if cultures}}
                                <div class="select-css">
                                    <select name="culture"
                                            class="culture {{#ifeq ../../data.origin key}}checked{{/ifeq}}">
                                        {{#select ../../data.culture}}
                                        <option value="">---</option>
                                        {{#each cultures}}
                                        <option value="{{key}}">{{name}}</option>
                                        {{/each}}
                                        {{/select}}
                                    </select>
                                </div>
                                {{/if}} <!--cultures-->
                            </label>
                        </div>
                        {{/each}} <!--origins-->
                    </div>
                </div>
                {{/each}} <!--archetypes -->

            </main>
        </section>

        <section class="round-box img-left" style="background-image: url('systems/dsa5/icons/categories/Skill.webp')">
            <header>
                <h2>Profession</h2>
            </header>
            <main>
                <div class="flow" style="margin-left: 53px">

                    {{#each professions}}
                    <div class="boxed-radio">
                        <input name="profession" value="{{_id}}" type="radio" data-profession-name="{{name}}"
                               id="profession{{_id}}" data-dtype="String" {{checked_radio _id ../data.profession}} />
                        <label for="profession{{_id}}" class="inputbox" style="background-image: url('{{img}}')">
                            <span>{{name}}</span>
                        </label>
                    </div>
                    {{/each}}
                    <!-- each professions -->
                </div>
            </main>
        </section>


        <section class="round-box no-header">
            <main class="col-3">

                <section class="round-box inner">
                    <header>
                        <h2>Geschlecht</h2>
                    </header>
                    <main>
                        <div class="flow">

                            <!-- gender options box -->
                            {{#each settings.genderOptions}}
                            <div class="boxed-radio">
                                <input id="gender-{{key}}" name="gender" value="{{key}}" type="radio"
                                       data-dtype="String"
                                       {{checked_radio key ../data.gender}} />
                                <label for="gender-{{key}}" style="width:32px; text-align: center"><i
                                        class="{{icon}}"></i></label>
                            </div>
                            {{/each}}
                            <!-- each settings.genderOptions -->
                        </div>
                    </main>
                </section>


                <section class="round-box inner">
                    <header>
                        <h2>Anzahl</h2>
                    </header>
                    <main>
                        <div class="boxed-input">
                            <input id="box4" name="anzahl" type="text" value="{{data.anzahl}}"/>
                            <label for="box4">Anzahl / Formular</label>
                        </div>
                    </main>
                </section>

                <section class="round-box inner">
                    <header>
                        <h2>Position in Szene</h2>
                    </header>
                    <main>
                        <div class="card {{data.tokenPosition}}">
                            <label>
                                <select name="tokenPosition" style="width:100%; margin: 0 -5px;font-size: 0.7em">
                                    {{#select data.tokenPosition}}
                                    <option value="">kein Import in Szene</option>
                                    {{#each tokenPositionOptions}}
                                    <option value="{{key}}">{{name}}</option>
                                    {{/each}}
                                    {{/select}}
                                </select>
                            </label>
                        </div>
                    </main>
                </section>

                <button name="generate-nsc" type="button" style="grid-column: span 3">Zufalls NSC jetzt generieren</button>


            </main>
        </section>


        <section class="round-box">
            <header>
                <h2>Vorschau</h2>
            </header>
            <main class="col-2">

                <div class="round-box inner">
                    <div>
                        <button class="dice" name="generate-name" type="button">Name<br/> <i
                                class="fas fa-dice"></i></button>
                    </div>

                    <div class="card nsc_name {{nactive data.nsc_name}}">
                        <label class="inputbox text">
                        <textarea name="nsc_name" placeholder="(Name wird automatisch generiert)" type="text"
                                  data-dtype="String">{{data.nsc_name}}</textarea>
                        </label>
                    </div>
                </div>

                <div class="round-box inner">
                    <div>
                        <button class="dice" name="generate-image" type="button">Bild<br/> <i
                                class="fas fa-dice"></i></button>
                    </div>
                    <div class="card nsc_name {{nactive data.nsc_img}}">
                        {{#if data.nsc_img}}
                        <img src="{{data.nsc_img}}" style="width: 165px; height: 165px; object-fit: cover"/>
                        {{else}}
                        <i>Bild wird automatisch generiert</i>
                        {{/if}}
                    </div>
                </div>
            </main>
        </section>


        <section class="round-box">
            <header>
                <h2>Konfiguration speichern</h2>
            </header>
            <main>

                <!-- store pattern for quick access -->
                <div class="round-box container flow">
                    <div class="card {{nactive data.patternName}}">
                        <label class="inputbox text">
                            <input name="patternName" placeholder="" value="{{data.patternName}}" type="text"
                                   data-dtype="String"/>
                        </label>
                    </div>

                    <div class="button-box">
                        {{#unless data.patternName}}
                        <button disabled class="inactive" type="button">speichern</button>
                        {{else}}
                        <button name="store-pattern" type="button">speichern</button>
                        {{/unless}}
                    </div>
                </div>

            </main>
        </section>

    </section>


    <!-- add players and stored NPC into viewed scene -->
    <section class="tab" data-tab="characters">
        <form class="nsc-form">
            <h1>Heldengruppe</h1>
            <div class="round-box container flow"
                 style="background-image: url('systems/dsa5/icons/categories/ability_fate_points.webp')">

                {{#ifeq players.length 0}}
                <h2><i>(atuell sind leider<br/> keine Spieler online.)</i></h2>
                {{/ifeq}}
                <!--ifeq players undefined-->

                {{#each players}}
                <div class="card {{ifIsProperty ../data.playerSelection _id 'active'}}">
                    <label class="inputbox checkbox profession"
                           style="background-image: url('{{img}}')">
                        {{name}}
                        <input name="playerSelection.{{_id}}" type="checkbox" data-dtype="Boolean"/>
                    </label>
                </div>
                {{/each}}
                <!--each players-->
            </div>

            <!-- import player -->
            <div class="round-box container flow submit">

                <div class="card {{data.playerTokenPosition}}">
                    <label>
                        <select name="playerTokenPosition" style="width:100%; margin: 0 -5px;font-size: 0.7em">
                            {{#select data.playerTokenPosition}}
                            {{#each tokenPositionOptions}}
                            <option value="{{key}}">{{name}}</option>
                            {{/each}}
                            {{/select}}
                        </select>
                    </label>
                </div>

                <div>
                    <div class="button">
                        {{#ifeq players.length 0}}
                        <button disabled class="inactive" type="button">ausgewählte Helden in Szene bewegen</button>
                        {{else}}
                        <button name="import-selected-players" type="button">ausgewählte Helden in Szene bewegen
                        </button>
                        {{/ifeq}}
                    </div>
                </div>
            </div>

        </form>
        <hr/>

        <form class="nsc-form">
            <!-- each Kompendium as a box -->
            {{#each packNscSelection}}
            <h1>{{name}}</h1>
            <div class="round-box container flow"
                 style="background-image: url('systems/dsa5/icons/categories/DSA-Auge.webp')">
                {{#each index}}
                <div class="card {{ifIsProperty ../../data.packNscSelection _id 'active'}}">
                    <label class="inputbox checkbox profession"
                           style="background-image: url('{{img}}')">
                        {{name}}
                        <input name="packNscSelection.{{_id}}" type="checkbox" data-dtype="Boolean"/>
                    </label>
                </div>
                {{/each}}
                <!--each index-->
            </div>
            {{/each}}
            <!-- each npcList -->
        </form>

        <form class="nsc-form">
            <h1>Zufalls NSC</h1>
            <div class="round-box container flow"
                 style="background-image: url('systems/dsa5/icons/categories/DSA-Auge.webp')">
                {{#each stockNsc}}
                <div class="card {{ifIsProperty ../data.stockNscSelection _id 'active'}}">
                    <label class="inputbox checkbox profession"
                           style="background-image: url('{{img}}')">
                        {{name}}
                        <input name="stockNscSelection.{{_id}}" type="checkbox" data-dtype="Boolean"/>
                    </label>
                </div>
                {{/each}}
                <!--each stockNsc-->
            </div>
            <hr/>
            <div class="round-box container flow submit">
                <div class="card {{data.tokenPosition}}">
                    <select name="tokenPosition" style="width:100%; margin: 0 -5px;font-size: 0.7em">
                        {{#select data.tokenPosition}}
                        {{#each tokenPositionOptions}}
                        <option value="{{key}}">{{name}}</option>
                        {{/each}}
                        {{/select}}
                    </select>
                </div>
                <div>
                    <div class="button">
                        <button name="import-selected-npc" type="button">ausgewählte NSC in Szene bewegen</button>
                    </div>
                </div>
            </div>
        </form>

    </section>


</section>
